<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IT Email Ticket System</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <!-- Include the React app build -->
    <script defer src="/path-to-your-react-app/static/js/main.js"></script>
</head>

<body class="bg-light">
    <!-- React App Mount Point -->
    <div id="root"></div>
    
    <div class="container mt-5">
        <h1 class="text-center mb-4">IT Email Ticket System</h1>
        <form id="workOrderForm" class="card shadow p-4 mb-4">
            <fieldset>
                <legend class="mb-3">Work Order Information</legend>

                <!-- Customer and Account Information -->
                <div class="mb-3">
                    <label for="customer-name" class="form-label">Customer Name:</label>
                    <input type="text" id="customer-name" name="customer_name" class="form-control" required>
                </div>

                <div class="mb-3">
                    <label for="account-number" class="form-label">Account Number:</label>
                    <input type="text" id="account-number" name="account_number" class="form-control" required>
                </div>

                <div class="mb-3">
                    <label for="store-address" class="form-label">Store Address:</label>
                    <textarea id="store-address" name="store_address" rows="3" class="form-control" required></textarea>
                </div>

                <!-- Work Request Details -->
                <div class="mb-3">
                    <label for="work-request" class="form-label">Work Requested:</label>
                    <textarea id="work-request" name="work_requested" rows="5" class="form-control" required></textarea>
                </div>

                <!-- Contact Information -->
                <div class="mb-3">
                    <label for="contact-name" class="form-label">Store Contact Name:</label>
                    <input type="text" id="contact-name" name="store_contact_name" class="form-control" required>
                </div>

                <div class="mb-3">
                    <label for="contact-phone" class="form-label">Store Contact Phone:</label>
                    <input type="tel" id="contact-phone" name="store_contact_phone" class="form-control" required>
                </div>

                <!-- Work Performed -->
                <div class="mb-3">
                    <label for="work-performed" class="form-label">Work Performed:</label>
                    <textarea id="work-performed" name="work_performed" rows="5" class="form-control"></textarea>
                </div>
            </fieldset>

            <button type="button" class="btn btn-primary w-100" id="saveButton">Save Work Order</button>
        </form>

        <!-- Section to display saved work orders -->
        <div id="adminSection" class="card shadow p-4">
            <h2>Saved Work Orders</h2>
            <ul id="workOrderList" class="list-group"></ul>
        </div>
    </div>

    <script>
        // Function to generate a unique key (e.g., UUID-like)
        function generateUniqueKey() {
            return `key-${Date.now()}-${Math.random().toString(36).substring(2, 10)}`;
        }

        // Save button click event handler
        document.getElementById("saveButton").addEventListener("click", function () {
            const form = document.getElementById("workOrderForm");
            const formData = new FormData(form);
            const workOrderData = {};

            // Convert form data to JSON object
            formData.forEach((value, key) => {
                workOrderData[key] = value.trim();
            });

            // Generate a unique key for this work order
            const uniqueKey = generateUniqueKey();
            workOrderData.uniqueKey = uniqueKey;

            // Save the ticket to localStorage using the unique key
            localStorage.setItem(uniqueKey, JSON.stringify(workOrderData));

            // Log the saved work order to the console
            console.log(`Work Order Saved with Key ${uniqueKey}:`, workOrderData);

            // Provide user feedback and display the unique key below the form
            alert(`Work Order saved successfully with Key: ${uniqueKey}`);
            displaySavedWorkOrders();

            // Optionally, reset the form after saving
            form.reset();
        });

        // Function to display all saved work orders
        function displaySavedWorkOrders() {
            const workOrderList = document.getElementById("workOrderList");
            workOrderList.innerHTML = ""; // Clear the list

            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                const data = JSON.parse(localStorage.getItem(key));

                // Create a list item for each work order
                const listItem = document.createElement("li");
                listItem.className = "list-group-item";
                listItem.textContent = `Key: ${key}, Account: ${data.account_number}, Customer: ${data.customer_name}`;
                workOrderList.appendChild(listItem);
            }
        }

        // Call the function on page load to display saved work orders
        window.onload = displaySavedWorkOrders;
    </script>
</body>

</html>
