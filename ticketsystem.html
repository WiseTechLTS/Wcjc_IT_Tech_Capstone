<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IT Ticket System</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>

<body class="bg-light">
    <header class="bg-primary text-white text-center py-4 mb-4">
        <h1>IT Ticket Submission</h1>
    </header>

    <main class="container">
        <section class="card shadow p-4 mb-5">
            <h2 class="text-center mb-3">Submit a Ticket</h2>

            <form id="ticketForm" class="needs-validation" novalidate>
                <!-- Email -->
                <div class="mb-3">
                    <label for="email" class="form-label">Email Address:</label>
                    <input type="email" id="email" name="email" class="form-control" placeholder="example@domain.com" required>
                    <div class="invalid-feedback">Please provide a valid email address.</div>
                </div>

                <!-- Title -->
                <div class="mb-3">
                    <label for="title" class="form-label">Title:</label>
                    <input type="text" id="title" name="title" class="form-control" placeholder="Brief description of the issue" required>
                    <div class="invalid-feedback">Title is required.</div>
                </div>

                <!-- Description -->
                <div class="mb-3">
                    <label for="description" class="form-label">Description:</label>
                    <textarea id="description" name="description" class="form-control" rows="5" placeholder="Detailed description of the issue" required></textarea>
                    <div class="invalid-feedback">Description is required.</div>
                </div>

                <!-- Attachment -->
                <div class="mb-3">
                    <label for="attachment" class="form-label">Attachment (optional):</label>
                    <input type="file" id="attachment" name="attachment" class="form-control">
                </div>

                <button type="submit" class="btn btn-primary w-100">Submit Ticket</button>
            </form>
        </section>

        <!-- Display Messages -->
        <section id="messageSection" class="alert d-none"></section>
    </main>

    <script>
        document.getElementById("ticketForm").addEventListener("submit", async function (event) {
            event.preventDefault();

            const form = event.target;
            if (!form.checkValidity()) {
                form.classList.add("was-validated");
                return;
            }

            const formData = new FormData(form);

            try {
                const response = await fetch('http://127.0.0.1:8000/api/create-ticket/', {
                    method: 'POST',
                    body: formData
                });

                const messageSection = document.getElementById("messageSection");
                if (response.ok) {
                    const result = await response.json();
                    messageSection.className = "alert alert-success";
                    messageSection.textContent = "Ticket submitted successfully! Ticket ID: " + result.ticket_id;
                    form.reset();
                } else {
                    const errorData = await response.json();
                    messageSection.className = "alert alert-danger";
                    messageSection.textContent = "Failed to submit ticket: " + JSON.stringify(errorData);
                }
                messageSection.classList.remove("d-none");
            } catch (error) {
                const messageSection = document.getElementById("messageSection");
                messageSection.className = "alert alert-danger";
                messageSection.textContent = "An error occurred while submitting the ticket.";
                messageSection.classList.remove("d-none");
            }
        });
    </script>
</body>

</html>
