<!DOCTYPE html>
<html lang="en">
<head>
  <!-- ===================================================================
       HEAD SECTION
  =================================================================== -->
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Unified IT Ticket System with Dashboard</title>
  
  <!-- Bootstrap & FontAwesome -->
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
  />
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
  />

  <style>
    /* =========================================================
       GLOBAL & COMMON BASE STYLES
    ========================================================= */
    body {
      background-color: #f8f9fa;
      margin: 0;
      padding: 0;
      font-family: Arial, sans-serif;
    }
    header, nav, main, footer {
      width: 100%;
    }

    /* Hamburger Button for Offcanvas */
    .hamburger-btn {
      position: fixed;
      top: 20px;
      left: 20px;
      background: transparent;
      border: none;
      color: #000;
      font-size: 24px;
      cursor: pointer;
      z-index: 9999;
    }

    /* Main Container */
    .main-container {
      padding: 20px;
    }

    /* Common Form Layout */
    form.needs-validation {
      max-width: 600px;
      margin: 0 auto;
    }

    /* =========================================================
       HOSPITAL TICKET FORM
    ========================================================= */
    .hospital-ticket-container {
      margin: 20px auto;
      padding: 20px;
      background-color: #f4f4f4;
      max-width: 600px;
      border-radius: 8px;
      box-shadow: 0px 2px 5px rgba(0, 0, 0, 0.1);
    }
    .hospital-ticket-container label {
      font-weight: bold;
      margin-top: 10px;
    }
    .hospital-ticket-container input,
    .hospital-ticket-container select,
    .hospital-ticket-container textarea {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }
    .hospital-ticket-container .priority {
      margin-top: 10px;
    }
    .hospital-ticket-container button {
      background-color: #28a745;
      color: #fff;
      padding: 10px 15px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      margin-top: 15px;
    }
    .hospital-ticket-container button:hover {
      background-color: #218838;
    }

    /* =========================================================
       DASHBOARD (TICKET CARDS)
    ========================================================= */

    .dashboard-container {
      max-width: 1200px;
      margin: auto;
    }
    .card-container {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      grid-gap: 20px;
    }
    .ticket-card {
      background-color: #fff;
      border-radius: 8px;
      box-shadow: 0px 2px 5px rgba(0,0,0,0.1);
      padding: 16px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }
    .ticket-card h2 {
      font-size: 1rem;
      color: #333;
      margin-bottom: 10px;
    }
    .ticket-field {
      font-size: 0.9rem;
      margin-bottom: 6px;
    }
    .ticket-actions {
      margin-top: 10px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .priority-indicator {
      font-weight: bold;
      padding: 5px 10px;
      border-radius: 5px;
    }
    .priority-Low { background-color: #28a745; color: white; }
    .priority-Medium { background-color: #ffc107; color: black; }
    .priority-High { background-color: #fd7e14; color: white; }
    .priority-Critical { background-color: #dc3545; color: white; }
    .empty-message {
      text-align: center;
      font-weight: bold;
      color: #555;
      grid-column: 1 / -1;
    }
    .ticket-card h2 {
      margin-top: 0;
      font-size: 1.2rem;
      color: #333;
    }
    .ticket-field {
      margin-bottom: 8px;
    }
    .ticket-field label {
      font-weight: bold;
    }
    .ticket-actions {
      margin-top: 16px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .ticket-actions label {
      font-weight: normal;
      margin-bottom: 4px;
    }
    .ticket-actions select {
      width: 100%;
      padding: 6px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }
    button.save-btn {
      background-color: #007bff;
      color: #fff;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      padding: 8px 12px;
      width: fit-content;
    }
    button.save-btn:hover {
      background-color: #0069d9;
    }
    button.delete-btn {
      background-color: #dc3545;
      color: #fff;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      padding: 8px 12px;
      width: fit-content;
    }
    button.delete-btn:hover {
      background-color: #c82333;
    }
    .empty-message {
      text-align: center;
      font-weight: bold;
      color: #555;
      grid-column: 1 / -1;
    }
    .clear-btn {
      display: block;
      margin: 20px auto 0;
      padding: 10px 15px;
      background-color: #6c757d;
      color: #fff;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    .clear-btn:hover {
      background-color: #5a6268;
    }

    /* =========================================================
       FANCY CURSOR TRAIL
    ========================================================= */
    /* You can adjust these classes for custom design or performance. */

  </style>
</head>
<body>
  <!-- ============================================================
       NAVIGATION / OFFCANVAS
  ============================================================ -->
  <nav aria-label="Main navigation">
    <!-- Hamburger Button to Trigger Offcanvas -->
    <button
      class="hamburger-btn"
      data-bs-toggle="offcanvas"
      data-bs-target="#offcanvasTabs"
      aria-controls="offcanvasTabs"
      aria-label="Open navigation menu"
    >
      <i class="fas fa-bars"></i>
    </button>

    <!-- Offcanvas Menu for Tabs -->
    <div
      class="offcanvas offcanvas-end"
      tabindex="-1"
      id="offcanvasTabs"
      aria-labelledby="offcanvasTabsLabel"
    >
      <div class="offcanvas-header">
        <h5 class="offcanvas-title" id="offcanvasTabsLabel">Navigation</h5>
        <button
          type="button"
          class="btn-close text-reset"
          data-bs-dismiss="offcanvas"
          aria-label="Close navigation menu"
        ></button>
      </div>
      <div class="offcanvas-body">
        <ul class="nav flex-column">
          <li class="nav-item">
            <button
              class="nav-link"
              id="ticket-tab"
              data-bs-toggle="tab"
              data-bs-target="#ticket"
              type="button"
              role="tab"
              aria-controls="ticket"
              aria-selected="false"
            >
              Submit Ticket
            </button>
          </li>
          <li class="nav-item">
            <button
              class="nav-link"
              id="admin-tab"
              data-bs-toggle="tab"
              data-bs-target="#admin"
              type="button"
              role="tab"
              aria-controls="admin"
              aria-selected="false"
            >
              Admin Login
            </button>
          </li>
          <li class="nav-item">
            <button
              class="nav-link"
              id="hospital-tab"
              data-bs-toggle="tab"
              data-bs-target="#hospital"
              type="button"
              role="tab"
              aria-controls="hospital"
              aria-selected="false"
            >
              Hospital Trouble Ticket
            </button>
          </li>
          <li class="nav-item">
            <button
              class="nav-link"
              id="dashboard-tab"
              data-bs-toggle="tab"
              data-bs-target="#dashboard"
              type="button"
              role="tab"
              aria-controls="dashboard"
              aria-selected="false"
            >
              Ticket Dashboard
            </button>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- ============================================================
       HEADER
  ============================================================ -->
  <header class="bg-light py-3 text-center">
    <div class="container">
      <h1 class="mb-0">Unified IT Ticket System</h1>
      <p class="text-muted">Streamlined Ticket Submissions and Dashboard</p>
    </div>
  </header>

  <!-- ============================================================
       MAIN CONTENT
  ============================================================ -->
  <main class="main-container">
    <!-- ========== Tabs Container ========== -->
    <div class="tab-content" id="myTabContent">
      <!-- ========== 1) Standard Submit Ticket Tab ========== -->
      <section
        class="tab-pane fade"
        id="ticket"
        role="tabpanel"
        aria-labelledby="ticket-tab"
      >
        <div class="card">
          <header class="card-header bg-primary text-white text-center">
            <h2>Submit an IT Ticket</h2>
          </header>
          <div class="card-body bg-light text-dark">
            <form id="ticketForm" class="needs-validation" novalidate>
              <fieldset>
                <div class="mb-3">
                  <label for="name" class="form-label">Name</label>
                  <input
                    type="text"
                    class="form-control"
                    id="name"
                    name="name"
                    placeholder="Enter your name"
                    required
                  />
                  <div class="invalid-feedback">Please enter your name.</div>
                </div>
                <div class="mb-3">
                  <label for="email" class="form-label">Email</label>
                  <input
                    type="email"
                    class="form-control"
                    id="email"
                    name="email"
                    placeholder="Enter your email"
                    required
                  />
                  <div class="invalid-feedback">
                    Please enter a valid email address.
                  </div>
                </div>
                <div class="mb-3">
                  <label for="phone" class="form-label">Phone</label>
                  <input
                    type="tel"
                    class="form-control"
                    id="phone"
                    name="phone"
                    placeholder="Enter your phone number"
                    required
                  />
                  <div class="invalid-feedback">
                    Please enter your phone number.
                  </div>
                </div>
                <div class="mb-3">
                  <label for="address" class="form-label">Address</label>
                  <input
                    type="text"
                    class="form-control"
                    id="address"
                    name="address"
                    placeholder="Enter your address"
                    required
                  />
                  <div class="invalid-feedback">Please enter your address.</div>
                </div>
                <div class="mb-3">
                  <label for="text" class="form-label">Issue Description</label>
                  <textarea
                    class="form-control"
                    id="text"
                    name="text"
                    rows="4"
                    placeholder="Describe your issue"
                    required
                  ></textarea>
                  <div class="invalid-feedback">Please describe your issue.</div>
                </div>
                <div class="mb-3">
                  <label for="screenshot" class="form-label"
                    >Upload Screenshot (optional)</label
                  >
                  <input
                    type="file"
                    class="form-control"
                    id="screenshot"
                    name="screenshot"
                    accept="image/*"
                  />
                </div>
                <div class="text-center">
                  <button type="submit" class="btn btn-primary">
                    Submit Ticket
                  </button>
                </div>
              </fieldset>
            </form>
          </div>
        </div>
      </section>

      <!-- ========== 2) Admin Login Tab ========== -->
      <section
        class="tab-pane fade"
        id="admin"
        role="tabpanel"
        aria-labelledby="admin-tab"
      >
        <div class="card">
          <header class="card-header bg-secondary text-white text-center">
            <h2>Admin Panel</h2>
          </header>
          <div class="card-body bg-light text-dark">
            <!--
              We'll show either the admin login form OR
              a logout button, depending on isAdmin status.
            -->
            <div id="adminLoggedOut">
              <form id="adminLoginForm" class="needs-validation" novalidate>
                <fieldset>
                  <div class="mb-3">
                    <label for="adminUsername" class="form-label">Username</label>
                    <input
                      type="text"
                      class="form-control"
                      id="adminUsername"
                      name="adminUsername"
                      placeholder="Enter your username"
                      required
                    />
                    <div class="invalid-feedback">
                      Please enter your username.
                    </div>
                  </div>
                  <div class="mb-3">
                    <label for="adminPassword" class="form-label">Password</label>
                    <input
                      type="password"
                      class="form-control"
                      id="adminPassword"
                      name="adminPassword"
                      placeholder="Enter your password"
                      required
                    />
                    <div class="invalid-feedback">
                      Please enter your password.
                    </div>
                  </div>
                  <div class="text-center">
                    <button type="submit" class="btn btn-secondary">
                      Login
                    </button>
                  </div>
                </fieldset>
              </form>
            </div>

            <div id="adminLoggedIn" class="text-center" style="display: none;">
              <p class="mt-3">You are logged in as <strong>Administrator</strong>.</p>
              <button
                type="button"
                class="btn btn-danger"
                onclick="adminLogout()"
              >
                Logout
              </button>
            </div>
          </div>
        </div>
      </section>

      <!-- ========== 3) Hospital Trouble Ticket Tab ========== -->
      <section
        class="tab-pane fade"
        id="hospital"
        role="tabpanel"
        aria-labelledby="hospital-tab"
      >
        <header class="card-header bg-success text-white text-center">
          <h2>Hospital Trouble Ticket</h2>
        </header>
        <div class="hospital-ticket-container">
          <form
            id="hospitalTicketForm"
            action="#"
            method="post"
            novalidate
          >
            <!-- Department -->
            <label for="hospitalDepartment">Department:</label>
            <select
              id="hospitalDepartment"
              name="hospitalDepartment"
              required
              onchange="showHospitalSubDepartments()"
            >
              <option value="" disabled selected>Select a department category</option>
              <option value="Medical">Medical Departments</option>
              <option value="Administrative">Administrative Departments</option>
              <option value="Support">Support/Ancillary Departments</option>
            </select>

            <!-- Medical Sub-Department -->
            <div id="hospitalMedicalSub" style="display: none;">
              <label for="hospitalMedicalDepartment">Medical Sub-Department:</label>
              <select id="hospitalMedicalDepartment">
                <option value="ED">Emergency Department (ED)</option>
                <option value="OPD">Outpatient Department (OPD)</option>
                <option value="Inpatient">Inpatient Department</option>
                <option value="Surgery">Surgery (Operating Theatres)</option>
                <option value="ICU">Intensive Care Unit (ICU)</option>
                <option value="Pediatrics">Pediatrics</option>
                <option value="OB-GYN">Obstetrics and Gynecology (OB-GYN)</option>
                <option value="Cardiology">Cardiology</option>
                <option value="Oncology">Oncology</option>
                <option value="Orthopedics">Orthopedics</option>
                <option value="Neurology">Neurology</option>
                <option value="Psychiatry">Psychiatry and Mental Health</option>
                <option value="Dermatology">Dermatology</option>
                <option value="Radiology">Radiology and Imaging</option>
                <option value="Pathology">Pathology</option>
              </select>
            </div>

            <!-- Administrative Sub-Department -->
            <div id="hospitalAdminSub" style="display: none;">
              <label for="hospitalAdminDepartment"
                >Administrative Sub-Department:</label
              >
              <select id="hospitalAdminDepartment">
                <option value="Admissions">Admissions and Registration</option>
                <option value="Billing">Billing and Finance</option>
                <option value="HR">Human Resources (HR)</option>
                <option value="MedicalRecords">Medical Records/Health Info</option>
                <option value="QualityAssurance">Quality Assurance</option>
                <option value="PublicRelations">Public Relations/Marketing</option>
              </select>
            </div>

            <!-- Support Sub-Department -->
            <div id="hospitalSupportSub" style="display: none;">
              <label for="hospitalSupportDepartment"
                >Support/Ancillary Sub-Department:</label
              >
              <select id="hospitalSupportDepartment">
                <option value="Pharmacy">Pharmacy</option>
                <option value="Laboratory">Laboratory Services</option>
                <option value="Biomedical">Biomedical Engineering</option>
                <option value="Housekeeping">Housekeeping</option>
                <option value="Catering">Catering and Nutrition</option>
                <option value="Security">Security</option>
                <option value="IT">IT/Technology</option>
                <option value="Transport">Transport Services</option>
              </select>
            </div>

            <!-- Issue Description -->
            <label for="hospitalIssue">Describe the Issue:</label>
            <textarea
              id="hospitalIssue"
              name="hospitalIssue"
              rows="4"
              required
            ></textarea>

            <!-- Priority Level -->
            <label class="priority">Priority Level:</label>
            <div class="form-check">
              <input
                class="form-check-input"
                type="radio"
                id="hospitalLow"
                name="hospitalPriority"
                value="Low"
                required
              />
              <label class="form-check-label" for="hospitalLow">
                ðŸŸ¢ Low â€” Minor or no immediate impact
              </label>
            </div>

            <div class="form-check">
              <input
                class="form-check-input"
                type="radio"
                id="hospitalMedium"
                name="hospitalPriority"
                value="Medium"
              />
              <label class="form-check-label" for="hospitalMedium">
                ðŸŸ¡ Medium â€” Manageable disruption
              </label>
            </div>

            <div class="form-check">
              <input
                class="form-check-input"
                type="radio"
                id="hospitalHigh"
                name="hospitalPriority"
                value="High"
              />
              <label class="form-check-label" for="hospitalHigh">
                ðŸŸ  High â€” Significant urgency
              </label>
            </div>

            <div class="form-check">
              <input
                class="form-check-input"
                type="radio"
                id="hospitalCritical"
                name="hospitalPriority"
                value="Critical"
              />
              <label class="form-check-label" for="hospitalCritical">
                ðŸ”´ Critical â€” Immediate attention required
              </label>
            </div>

            <!-- (Optional) Hospital Screenshot Field:
                 Uncomment if needed for images
            <label for="hospitalScreenshot" class="form-label">
              Screenshot (optional)
            </label>
            <input
              type="file"
              class="form-control"
              id="hospitalScreenshot"
              name="hospitalScreenshot"
              accept="image/*"
            />
            -->

            <!-- Submit Button -->
            <button type="submit">Submit Ticket</button>
          </form>
        </div>
      </section>

      <!-- ========== 4) Ticket Dashboard Tab ========== -->
      <section
        class="tab-pane fade"
        id="dashboard"
        role="tabpanel"
        aria-labelledby="dashboard-tab"
      >
        <div class="dashboard-container">
          <h1>Hospital IT Ticket Dashboard</h1>
          <div class="card-container" id="cardContainer">
            <!-- Ticket cards injected by JavaScript -->
          </div>
          <button class="clear-btn" onclick="clearAllTickets()">
            Clear All Tickets
          </button>
        </div>
      </section>
    </div>
  </main>

  <!-- ============================================================
       FOOTER
  ============================================================ -->
  <footer class="text-center py-3 bg-light">
    <p class="mb-0">
      &copy; <span id="year"></span> Your Organization. All Rights Reserved.
    </p>
  </footer>

  <!-- ============================================================
       BOOTSTRAP & SCRIPTS
  ============================================================ -->
  <script
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"
    defer
  ></script>
  <script>
    // Update Footer Year
    document.addEventListener("DOMContentLoaded", () => {
      document.getElementById("year").textContent = new Date().getFullYear();
    });
  </script>

  <!-- ============================================================
       MAIN APP SCRIPTS
  ============================================================ -->
  <script>
    // =========================
    // PERSISTENT TAB SELECTION
    // =========================
    const tabButtons = document.querySelectorAll('button[data-bs-toggle="tab"]');
    tabButtons.forEach((btn) => {
      btn.addEventListener('show.bs.tab', function (e) {
        // e.target is the newly activated tab button
        // store the target's data-bs-target (the tab pane ID) in localStorage
        const newTabId = e.target.getAttribute('data-bs-target');
        localStorage.setItem('activeTabId', newTabId);
      });
    });

    // On page load, if there's a stored activeTabId, activate that tab
    document.addEventListener('DOMContentLoaded', () => {
      const storedTabId = localStorage.getItem('activeTabId');
      if (storedTabId) {
        const tabTrigger = document.querySelector(`button[data-bs-target="${storedTabId}"]`);
        if (tabTrigger) {
          // Use Bootstrap's Tab API to show the stored tab
          const tab = new bootstrap.Tab(tabTrigger);
          tab.show();
        }
      } else {
        // If no tab is stored, default to the first tab (Submit Ticket)
        const defaultTab = document.getElementById('ticket-tab');
        if (defaultTab) {
          const tab = new bootstrap.Tab(defaultTab);
          tab.show();
        }
      }
    });

    // =====================================
    // 1) STANDARD IT TICKET FORM SUBMISSION
    // =====================================
    const ticketForm = document.getElementById("ticketForm");
    ticketForm.addEventListener("submit", function (event) {
      event.preventDefault();
      event.stopPropagation();

      if (!ticketForm.checkValidity()) {
        ticketForm.classList.add("was-validated");
        return;
      }

      const fileInput = document.getElementById("screenshot");
      const file = fileInput && fileInput.files[0];

      function finishTicketCreation(screenshotData) {
        const ticketData = {
          department: "IT (User Submission)",
          subDepartment: "N/A",
          issue: document.getElementById("text").value,
          priority: "N/A",
          name: document.getElementById("name").value,
          email: document.getElementById("email").value,
          phone: document.getElementById("phone").value,
          address: document.getElementById("address").value,
          screenshot: screenshotData,
        };

        const ticketKey = `ticket-${Date.now()}`;
        localStorage.setItem(ticketKey, JSON.stringify(ticketData));
        alert("Your IT Ticket has been submitted (standard form).");

        ticketForm.reset();
        ticketForm.classList.remove("was-validated");
      }

      // If a screenshot was uploaded, convert it to Base64
      if (file) {
        const reader = new FileReader();
        reader.onload = (e) => {
          finishTicketCreation(e.target.result);
        };
        reader.readAsDataURL(file);
      } else {
        finishTicketCreation("");
      }
    });

    // ===========================
    // 2) SIMPLE ADMIN LOGIN LOGIC
    // ===========================
    const adminLoginForm = document.getElementById("adminLoginForm");
    const adminLoggedOutDiv = document.getElementById("adminLoggedOut");
    const adminLoggedInDiv = document.getElementById("adminLoggedIn");

    document.addEventListener("DOMContentLoaded", function () {
      // Check if admin is already logged in
      if (localStorage.getItem("isAdmin") === "true") {
        showAdminLoggedIn();
      } else {
        showAdminLoggedOut();
      }
    });

    function showAdminLoggedIn() {
      adminLoggedInDiv.style.display = "block";
      adminLoggedOutDiv.style.display = "none";
    }

    function showAdminLoggedOut() {
      adminLoggedInDiv.style.display = "none";
      adminLoggedOutDiv.style.display = "block";
    }

    adminLoginForm.addEventListener("submit", function (event) {
      event.preventDefault();
      event.stopPropagation();

      if (!adminLoginForm.checkValidity()) {
        adminLoginForm.classList.add("was-validated");
        return;
      }

      const username = document.getElementById("adminUsername").value;
      const password = document.getElementById("adminPassword").value;

      // Simple example: "admin"/"admin" as credentials
      if (username === "admin" && password === "admin") {
        localStorage.setItem("isAdmin", "true");
        alert("Administrator login successful.");
        showAdminLoggedIn();
        adminLoginForm.reset();
        adminLoginForm.classList.remove("was-validated");
      } else {
        alert("Invalid credentials. Please try again.");
      }
    });

    function adminLogout() {
      localStorage.setItem("isAdmin", "false");
      alert("You have logged out as Administrator.");
      showAdminLoggedOut();
    }

    // Expose the logout function globally so it can be called from button onclick
    window.adminLogout = adminLogout;

    // ===========================
    // 3) HOSPITAL TROUBLE TICKET
    // ===========================
    function showHospitalSubDepartments() {
      const department = document.getElementById("hospitalDepartment").value;
      document.getElementById("hospitalMedicalSub").style.display =
        department === "Medical" ? "block" : "none";
      document.getElementById("hospitalAdminSub").style.display =
        department === "Administrative" ? "block" : "none";
      document.getElementById("hospitalSupportSub").style.display =
        department === "Support" ? "block" : "none";
    }

    const hospitalTicketForm = document.getElementById("hospitalTicketForm");
    hospitalTicketForm.addEventListener("submit", function (event) {
      event.preventDefault();
      event.stopPropagation();

      if (!hospitalTicketForm.checkValidity()) {
        alert("Please fill out all required fields before submitting.");
        return;
      }

      /*
      // Uncomment if you add a screenshot field with ID #hospitalScreenshot
      const hospitalScreenshot = document.getElementById("hospitalScreenshot");
      const file = hospitalScreenshot && hospitalScreenshot.files[0];
      */

      function finalizeHospitalTicket(screenshotData) {
        const department = document.getElementById("hospitalDepartment").value;
        let subDepartmentValue = "";
        if (department === "Medical") {
          subDepartmentValue = document.getElementById("hospitalMedicalDepartment").value;
        } else if (department === "Administrative") {
          subDepartmentValue = document.getElementById("hospitalAdminDepartment").value;
        } else if (department === "Support") {
          subDepartmentValue = document.getElementById("hospitalSupportDepartment").value;
        }

        const jsonObject = {
          department: department,
          subDepartment: subDepartmentValue,
          issue: document.getElementById("hospitalIssue").value,
          priority: hospitalTicketForm.querySelector(
            'input[name="hospitalPriority"]:checked'
          ).value,
          screenshot: screenshotData,
        };

        const ticketKey = `ticket-${Date.now()}`;
        localStorage.setItem(ticketKey, JSON.stringify(jsonObject));

        alert("âœ… Hospital ticket has been successfully saved locally.");
        hospitalTicketForm.reset();
      }

      // If screenshot field is present & a file is provided, convert to Base64
      /*
      if (file) {
        const reader = new FileReader();
        reader.onload = function (e) {
          finalizeHospitalTicket(e.target.result);
        };
        reader.readAsDataURL(file);
      } else {
        finalizeHospitalTicket("");
      }
      */
      finalizeHospitalTicket("");
    });

    // ===========================
    // 4) TICKET DASHBOARD LOGIC
    // ===========================
    function loadTickets() {
      const cardContainer = document.getElementById("cardContainer");
      cardContainer.innerHTML = "";
      const allKeys = Object.keys(localStorage).filter((key) =>
        key.startsWith("ticket-")
      );

      if (allKeys.length === 0) {
        cardContainer.innerHTML =
          '<p class="empty-message">No tickets found in local storage.</p>';
        return;
      }

      allKeys.forEach((key) => {
        const ticketData = JSON.parse(localStorage.getItem(key)) || {};
        const cardDiv = document.createElement("div");
        cardDiv.classList.add("ticket-card");

        const priorityClass = ticketData.priority
          ? "priority-" + ticketData.priority
          : "priority-Low";

        cardDiv.innerHTML = `
          ${
            ticketData.screenshot
              ? `<img src="${ticketData.screenshot}" class="img-fluid mb-2" alt="Attached Screenshot" />`
              : ""
          }
          <h2>Ticket ID: ${key}</h2>
          <div class="ticket-field"><strong>Department:</strong> ${
            ticketData.department || "N/A"
          }</div>
          <div class="ticket-field"><strong>Sub-Department:</strong> ${
            ticketData.subDepartment || "N/A"
          }</div>
          <div class="ticket-field"><strong>Issue:</strong> ${
            ticketData.issue || "N/A"
          }</div>
          <div class="ticket-field">
            <strong>Priority:</strong>
            <span class="priority-indicator ${priorityClass}">${
          ticketData.priority || "N/A"
        }</span>
          </div>
          ${
            ticketData.name
              ? `<div class="ticket-field"><strong>Name:</strong> ${ticketData.name}</div>`
              : ""
          }
          ${
            ticketData.email
              ? `<div class="ticket-field"><strong>Email:</strong> ${ticketData.email}</div>`
              : ""
          }
          ${
            ticketData.phone
              ? `<div class="ticket-field"><strong>Phone:</strong> ${ticketData.phone}</div>`
              : ""
          }
          ${
            ticketData.address
              ? `<div class="ticket-field"><strong>Address:</strong> ${ticketData.address}</div>`
              : ""
          }

          <div class="ticket-actions">
            <label for="prioritySelect-${key}"><strong>Change Priority:</strong></label>
            <select id="prioritySelect-${key}" class="form-control">
              <option value="Low" ${
                ticketData.priority === "Low" ? "selected" : ""
              }>Low</option>
              <option value="Medium" ${
                ticketData.priority === "Medium" ? "selected" : ""
              }>Medium</option>
              <option value="High" ${
                ticketData.priority === "High" ? "selected" : ""
              }>High</option>
              <option value="Critical" ${
                ticketData.priority === "Critical" ? "selected" : ""
              }>Critical</option>
            </select>
            <button
              class="save-btn btn btn-primary mt-2"
              onclick="saveNewPriority('${key}')"
            >
              Save Priority
            </button>
            <button
              class="delete-btn btn btn-danger mt-2"
              onclick="deleteTicket('${key}')"
            >
              Delete Ticket
            </button>
          </div>
        `;
        cardContainer.appendChild(cardDiv);
      });
    }

    function saveNewPriority(key) {
      const selectEl = document.getElementById(`prioritySelect-${key}`);
      if (!selectEl) return;

      const newPriority = selectEl.value;
      const ticketData = JSON.parse(localStorage.getItem(key)) || {};
      ticketData.priority = newPriority;

      localStorage.setItem(key, JSON.stringify(ticketData));
      loadTickets();
    }

    function deleteTicket(key) {
      if (confirm("Are you sure you want to delete this ticket?")) {
        localStorage.removeItem(key);
        loadTickets();
      }
    }

    function clearAllTickets() {
      if (confirm("Are you sure you want to clear ALL tickets?")) {
        Object.keys(localStorage).forEach((key) => {
          if (key.startsWith("ticket-")) {
            localStorage.removeItem(key);
          }
        });
        loadTickets();
      }
    }

    window.addEventListener("load", loadTickets);

    // ==========================================
    // 5) FANCY CURSOR TRAIL (JS ANIMATION)
    // ==========================================
    (function () {
      const TRAIL_CONFIG = {
        circleSize: 10,
        circleColor: "rgba(0, 120, 255, 0.7)",
        circleBlur: "10px",
        trailLength: 15,
        fadeSpeed: 0.02,
        showCursorRing: true,
        ringSize: 10,
        ringColor: "rgba(0, 0, 100, 0.15)",
      };

      let circles = [];
      let ringCircle = null;

      function createCircle() {
        const circle = document.createElement("div");
        circle.style.position = "fixed";
        circle.style.zIndex = 99999;
        circle.style.width = TRAIL_CONFIG.circleSize * 2 + "px";
        circle.style.height = TRAIL_CONFIG.circleSize * 2 + "px";
        circle.style.borderRadius = "50%";
        circle.style.backgroundColor = TRAIL_CONFIG.circleColor;
        circle.style.pointerEvents = "none";
        if (TRAIL_CONFIG.circleBlur) {
          circle.style.boxShadow = `0 0 ${TRAIL_CONFIG.circleBlur} ${TRAIL_CONFIG.circleColor}`;
        }
        document.body.appendChild(circle);
        return circle;
      }

      function createRingCircle() {
        const ring = document.createElement("div");
        ring.style.position = "fixed";
        ring.style.zIndex = 99998;
        ring.style.width = TRAIL_CONFIG.ringSize * 2 + "px";
        ring.style.height = TRAIL_CONFIG.ringSize * 2 + "px";
        ring.style.borderRadius = "50%";
        ring.style.border = `2px solid ${TRAIL_CONFIG.circleColor}`;
        ring.style.backgroundColor = TRAIL_CONFIG.ringColor;
        ring.style.pointerEvents = "none";
        ring.style.mixBlendMode = "lighten";
        document.body.appendChild(ring);
        return ring;
      }

      function onMouseMove(e) {
        const { clientX, clientY } = e;
        if (ringCircle) {
          const ringRadius = TRAIL_CONFIG.ringSize;
          ringCircle.style.left = clientX - ringRadius + "px";
          ringCircle.style.top = clientY - ringRadius + "px";
        }

        if (circles.length >= TRAIL_CONFIG.trailLength) {
          const oldest = circles.shift();
          oldest.x = clientX;
          oldest.y = clientY;
          oldest.alpha = 1;
          circles.push(oldest);
        } else {
          const circleElem = createCircle();
          circles.push({
            elem: circleElem,
            x: clientX,
            y: clientY,
            alpha: 1,
          });
        }
      }

      function animateCircles() {
        circles.forEach((circleData) => {
          const { elem, x, y } = circleData;
          const size = TRAIL_CONFIG.circleSize;
          elem.style.left = x - size + "px";
          elem.style.top = y - size + "px";
          circleData.alpha -= TRAIL_CONFIG.fadeSpeed;
          circleData.alpha = Math.max(circleData.alpha, 0);
          elem.style.opacity = circleData.alpha;
        });
        requestAnimationFrame(animateCircles);
      }

      function initCursorTrail() {
        if (TRAIL_CONFIG.showCursorRing) {
          ringCircle = createRingCircle();
        }
        window.addEventListener("mousemove", onMouseMove);
        animateCircles();
      }

      window.addEventListener("DOMContentLoaded", initCursorTrail);
    })();
  </script>
</body>
</html>
